{% extends 'base.html' %}
{% load static %}


{% block content %}
  
  <!-- Main Body begins ----------------------------------------------->
  <main role="main" class="col-12 col-xl-10">
    <div class="container-fluid my-2">

      <div class="row justify-content-center align-items-center my-2">
        <div class="col-12 col-md-6 my-2">
          <h4>Bem vindo, <span class="h4">{{ user.first_name }}!</span> </h4>
          <p class="m-0">Acompanhe de perto sua carteira!</p>
        </div>
        <div class="col-12 col-md-6 my-2 d-flex align-items-center justify-content-md-end">
          <h6>{{weekday}}, {{today}}</h6>
        </div>
      </div>

      <!-- Performance e Dividendos - Início -->
      <div class="row d-flex my-5">
        
        <div class="col-md-6">
          <div class="card h-100">
            <h5 class="card-header ps-5 text-bg-primary">Performance</h5>
            <div class="card-body p-5">
              
              <h5 id="yield" class="fs-3">R$0,00</h5>
              <h5 class="fs-6">Resultado</h5>
              
              <div class="d-flex align-items-center fs-5 mt-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" id="dividendsSwitch">
                  <label class="form-check-label" for="dividendsSwitch">Considerar reinvestimento dos dividendos</label>
                </div>
                <div id="spinner" class="spinner-border spinner-border-sm text-primary" role="status" hidden>
                  <span class="visually-hidden">Loading...</span>
                </div> 
              </div>
              <span class="card-text">O valor dos dividendos são subtraídos dos valores aportados.</span>
            </div>
          </div>
        </div>

        <div class="col-md-6 mt-md-0 mt-3">
          <div class="card h-100">
            <h5 class="card-header ps-5 text-bg-primary">Proventos</h5>
            <div class="card-body p-5">
              
              <h5 id="yield" class="fs-3">R$ 0,00</h5>
              <h5 class="fs-6">Recebidos</h5>
              <span class="card-text">Soma de todos os proventos recebidos.</span>
              <div class="d-flex mt-1">
                <a href="#" class="btn btn-outline-primary">Ver Proventos</a>
              </div>

            </div>
          </div>
        </div>

      </div>
      <!-- Performance e Dividendos - Início -->


      <!-- Gráfico Evolução Patrimonial + quatro cards - INÍCIO -->
      <div class="row">

        <!-- Gráfico de evolução patrimonial INÍCIO -->
        <div class="col-12 col-xl-7 mb-3 mb-xl-0">

          <div class="card">
            <h5 class="card-header ps-5 text-bg-primary">Evolução Patrimonial</h5>
            <div class="card-body">
              <div id="performanceChart" class="chart-container align-items-center ms-0" style="width: 100%; height: 45vh; min-height: 380px; background-color: white;">
                <div id="performanceChartStatus"  style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
                  <span class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </span>
                </div>
              </div>
            </div>
          </div>

        </div>
        <!-- Gráfico de evolução patrimonial FIM -->

        <div class="col-12 col-xl-5 ">
            <div class="d-flex flex-column h-100">
                <div class="row flex-fill">
                    <div class="col-md-6 mb-2">
                        <div class="card h-100 ps-5 ps-xl-3 ps-xxl-5 py-2 justify-content-center card-first hover-shadow">
                          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-piggy-bank" viewBox="0 0 16 16">
                            <path d="M5 6.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0zm1.138-1.496A6.613 6.613 0 0 1 7.964 4.5c.666 0 1.303.097 1.893.273a.5.5 0 0 0 .286-.958A7.602 7.602 0 0 0 7.964 3.5c-.734 0-1.441.103-2.102.292a.5.5 0 1 0 .276.962z"/>
                            <path fill-rule="evenodd" d="M7.964 1.527c-2.977 0-5.571 1.704-6.32 4.125h-.55A1 1 0 0 0 .11 6.824l.254 1.46a1.5 1.5 0 0 0 1.478 1.243h.263c.3.513.688.978 1.145 1.382l-.729 2.477a.5.5 0 0 0 .48.641h2a.5.5 0 0 0 .471-.332l.482-1.351c.635.173 1.31.267 2.011.267.707 0 1.388-.095 2.028-.272l.543 1.372a.5.5 0 0 0 .465.316h2a.5.5 0 0 0 .478-.645l-.761-2.506C13.81 9.895 14.5 8.559 14.5 7.069c0-.145-.007-.29-.02-.431.261-.11.508-.266.705-.444.315.306.815.306.815-.417 0 .223-.5.223-.461-.026a.95.95 0 0 0 .09-.255.7.7 0 0 0-.202-.645.58.58 0 0 0-.707-.098.735.735 0 0 0-.375.562c-.024.243.082.48.32.654a2.112 2.112 0 0 1-.259.153c-.534-2.664-3.284-4.595-6.442-4.595zM2.516 6.26c.455-2.066 2.667-3.733 5.448-3.733 3.146 0 5.536 2.114 5.536 4.542 0 1.254-.624 2.41-1.67 3.248a.5.5 0 0 0-.165.535l.66 2.175h-.985l-.59-1.487a.5.5 0 0 0-.629-.288c-.661.23-1.39.359-2.157.359a6.558 6.558 0 0 1-2.157-.359.5.5 0 0 0-.635.304l-.525 1.471h-.979l.633-2.15a.5.5 0 0 0-.17-.534 4.649 4.649 0 0 1-1.284-1.541.5.5 0 0 0-.446-.275h-.56a.5.5 0 0 1-.492-.414l-.254-1.46h.933a.5.5 0 0 0 .488-.393zm12.621-.857a.565.565 0 0 1-.098.21.704.704 0 0 1-.044-.025c-.146-.09-.157-.175-.152-.223a.236.236 0 0 1 .117-.173c.049-.027.08-.021.113.012a.202.202 0 0 1 .064.199z"/>
                          </svg>
                          <p class="mb-2 fw-semibold">Patrimônio</p>
                          <p id="equity" class="fs-5 fw-bold text-body-secondary mb-0">R$ 0,00</p>
                          <p><span id="equityChange" class="mb-0 fw-semibold">0%</span> <span id="equityPeriod" class="text-body-secondary">()</span></p>
                        </div>
                    </div>
                    <div class="col-md-6 mt-2 mt-md-0 mb-2">
                        <div class="card h-100 ps-5 ps-xl-3 ps-xxl-5 py-2 justify-content-center card-second hover-shadow">
                          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-currency-dollar" viewBox="0 0 16 16">
                            <path d="M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718H4zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73l.348.086z"/>
                          </svg>
                          <p class="mb-2 fw-semibold">Aportes (Total) </p>
                          <p id="contribution" class="fs-5 fw-bold text-body-secondary mb-0">R$ 0,00</p>
                          <p><span id="contributionChange" class="mb-0 fw-semibold">0%</span> <span id="contributionPeriod" class="text-body-secondary">()</span></p>
                        </div>
                    </div>
                </div>
                <div class="row flex-fill mt-md-2">
                    <div class="col-md-6 mt-2">
                        <div class="card h-100 ps-5 ps-xl-3 ps-xxl-5 py-2 justify-content-center card-third hover-shadow">
                          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-graph-up-arrow" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0Zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5Z"/>
                          </svg>
                          <p class="mb-2 fw-semibold">Rendimento</p>
                          <p id="result" class="fs-5 fw-bold text-body-secondary mb-0">0%</p>
                          <p><span id="resultChange" class="mb-0 fw-semibold">0</span> <span id="resultPeriod" class="text-body-secondary">()</span></p>
                        </div>
                    </div>
                    <div class="col-md-6 mt-3 mt-md-2">
                        <div class="card h-100 ps-5 ps-xl-3 ps-xxl-5 py-2 justify-content-center card-fourth hover-shadow">
                          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-percent" viewBox="0 0 16 16">
                            <path d="M13.442 2.558a.625.625 0 0 1 0 .884l-10 10a.625.625 0 1 1-.884-.884l10-10a.625.625 0 0 1 .884 0zM4.5 6a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm0 1a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5zm7 6a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm0 1a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z"/>
                          </svg>
                          <p class="mb-2 fw-semibold">YoC (%)</p>
                          <p id="yieldOnCost" class="fs-5 fw-bold text-body-secondary mb-0">0 %</p>
                          <p><span id="yieldOnCostChange" class="mb-0 fw-semibold">0</span> <span id="yieldOnCostPeriod" class="text-body-secondary">()</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <!-- Gráfico Evolução Patrimonial + quatro cards - FIM -->


      <!-- Gráficos de Exposição por Categorias e por Ativos - INÍCIO -->
      <div class="row mt-5">
        <div class="col-auto fs-5">
          Divisão do Portfolio:
        </div>
      </div>
      <div class="row mb-5">
        <div class="col-12 col-xl-6 my-2">

          <div id="categoryChart" class="chart-container d-flex justify-content-center align-items-center border rounded hover-shadow px-2 pt-4" style="width: 100%; height: 50vh; min-height: 320px; background-color: white;">
            <div id="categoryChartStatus" style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
              <span class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Loading...</span>
              </span>
            </div>
          </div>
          
        </div>
        
        <div class="col-12 col-xl-6 my-2">

          <div id="assetChart" class="chart-container d-flex justify-content-center align-items-center border rounded hover-shadow px-2 pt-4" style="width: 100%; height: 50vh; min-height: 320px; background-color: white;">
            <div id="assetChartStatus" style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
              <span class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Loading...</span>
              </span>
            </div>
          </div>

        </div>
      </div>
      <!-- Gráficos de Exposição por Categorias e por Ativos - FIM -->

      <!-- Gráficos de aportes mensais e de variação dos ativos - Início -->
      <div class="row mt-5">
        <div class="col-auto fs-5">
          Aportes mensais e variação dos ativos:
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-12 col-xl-6 my-2">
          <div id="contributionChart" class="chart-container d-flex justify-content-center align-items-center border rounded hover-shadow px-2 pt-4" style="width: 100%; height: 40vh; min-height: 320px; background-color: white;">
            <div id="contributionChartStatus" style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
              <span class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Loading...</span>
              </span>
            </div>
          </div>
        </div>
        <div class="col-12 col-xl-6 my-2">
          <div id="assetVariationChart" class="chart-container d-flex justify-content-center align-items-center border rounded hover-shadow px-2 pt-4" style="width: 100%; height: 40vh; min-height: 320px; background-color: white;">
            <div id="assetVariationChartStatus" style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
              <span class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Loading...</span>
              </span>
            </div>
          </div>
        </div>
      </div>
      <!-- Gráficos de evolução dos aportes e de variação dos ativos - Fim -->

    </div>
  </main>
  <!-- Main Body ends --------------------------------------------->
  


  {% include 'includes/message.html' %}

  <script> var DashBoardDataURL = "{% url 'get_dashboard_data' subtract_dividends='N' %}" </script>
  <script src="{% static 'themes/shine.js' %}"></script>
  <script src="{% static 'js/dashboardOptions.js' %}"></script>
  <script src="{% static 'js/dashboardCharts.js' %}" type="text/javascript"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const dividendsSwitch = document.getElementById('dividendsSwitch');
      dividendsSwitch.addEventListener('change', async function () {
        if (this.checked) {
          document.querySelector('#spinner').hidden = false;
          var DashBoardDataURL = "{% url 'get_dashboard_data' subtract_dividends='Y' %}"
          await updateDashboardData(DashBoardDataURL)
          document.querySelector('#spinner').hidden = true;
        } else {
          document.querySelector('#spinner').hidden = false;
          var DashBoardDataURL = "{% url 'get_dashboard_data' subtract_dividends='N' %}"
          await updateDashboardData(DashBoardDataURL)
          document.querySelector('#spinner').hidden = true;
        }
      });
    });
  </script>
  
{% endblock %}





